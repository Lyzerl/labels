<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>נתוני Priority - לפי סניף</title>
<!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">
<!-- קובץ CSS מקומי -->
<link rel="stylesheet" href="css/styles.css">
</head>
<body>

<div class="container">
  <!-- תפריט ניווט -->
  <nav class="main-nav">
    <a href="index.html" class="nav-link active">🏠 דף הבית</a>
    <a href="menu.html" class="nav-link">📅 תפריטים</a>
    <a href="search-labels.html" class="nav-link">🔍 חיפוש מוסד</a>
  </nav>

  <h1>📊 נתוני Priority - לפי תאריך וסניף</h1>

  <div class="controls">
    <div class="control-group">
      <label for="dateInput">תאריך:</label>
      <input type="date" id="dateInput">
    </div>
    
    <div class="control-group">
      <label for="branchSelect">סניף:</label>
      <select id="branchSelect">
        <option value="all">הכל</option>
        <option value="south">דרום </option>
        <option value="north">צפון </option>
      </select>
    </div>
    
    <button class="btn" onclick="fetchData()" id="fetchBtn">🔄 משוך נתונים</button>
    <button class="btn download" onclick="downloadCSV()" id="downloadBtn" disabled>📥 הורד CSV</button>
  </div>

  <div id="status"></div>

  <div class="stats">
    <div class="stat-item">
      <div class="stat-label">רשומות</div>
      <div class="stat-value" id="recordCount">0</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">דפים</div>
      <div class="stat-value" id="pageCount">0</div>
    </div>
  </div>

  <!-- טאבים לדוחות -->
  <div class="tabs" id="tabsContainer" style="display: none;">
    <button class="tab-btn active" onclick="showTab('general', this)">📋 טבלה כללית</button>
    <button class="tab-btn" onclick="showTab('summary', this)">❄️ דוח אריזה קרה</button>
    <button class="tab-btn" onclick="showTab('trays', this)">🔥 דוח אריזה חמה</button>
    <button class="tab-btn" onclick="showTab('allergens', this)">🚫 דוח אלרגנים</button>
    <button class="tab-btn" onclick="showTab('labels', this)">🏷️ דוח מדבקות</button>
    <button class="tab-btn" onclick="showTab('allergenLabels', this)">🥜 מדבקות אלרגנים</button>
  </div>

  <!-- תוכן טאבים -->
  <div id="tabGeneral" class="tab-content active">
  <div class="table-container" id="tableContainer"></div>
  </div>

  <div id="tabSummary" class="tab-content">
    <div class="report-controls">
      <label>סניף:</label>
      <select id="summaryBranchFilter">
        <option value="">הכל</option>
      </select>
      <label>לפי קטגוריה:</label>
      <select id="summaryPSPEC6Filter">
        <option value="all">הכל</option>
        <option value="notempty">רק לא ריק</option>
      </select>
      <button class="btn download" onclick="downloadSummaryCSV()" id="downloadSummaryBtn">📥 הורד CSV</button>
    </div>
    <div class="table-container" id="summaryContainer"></div>
  </div>

  <div id="tabTrays" class="tab-content">
    <div class="report-controls">
      <label>סניף:</label>
      <select id="traysBranchFilter">
        <option value="">הכל</option>
      </select>
      <label>קו חלוקה:</label>
      <select id="traysDistrLineFilter">
        <option value="">הכל</option>
      </select>
      <button class="btn download" onclick="downloadTraysPDF()" id="downloadTraysPDFBtn">📄 הורד PDF</button>
    </div>
    <div class="table-container" id="traysContainer"></div>
  </div>

  <div id="tabAllergens" class="tab-content">
    <div class="report-controls">
      <button class="btn download" onclick="printAllergensReport()">🖨️ הדפס / PDF</button>
    </div>
    <div class="table-container" id="allergensContainer"></div>
  </div>

  <div id="tabContainers" class="tab-content">
    <div class="report-controls">
      <label>סניף:</label>
      <select id="containersBranchFilter">
        <option value="">הכל</option>
      </select>
      <button class="btn" onclick="applyContainersFilters()">🔍 החל סינון</button>
      <button class="btn download" onclick="downloadContainersCSV()" id="downloadContainersBtn">📥 הורד CSV</button>
    </div>
    <div class="table-container" id="containersContainer"></div>
  </div>

  <div id="tabLabels" class="tab-content">
    <div class="report-controls">
      <label>קו חלוקה:</label>
      <select id="distrLineFilter">
        <option value="">הכל</option>
      </select>
      <label>סוג מדבקה:</label>
      <select id="labelsTempFilter">
        <option value="all">הכל</option>
        <option value="cold">קרים</option>
        <option value="hot">חמים</option>
      </select>
      <label>שיטת אריזה ראשית:</label>
      <select id="packingMethodFilter">
        <option value="">הכל</option>
      </select>
      <label>סדר מיון:</label>
      <select id="labelsSortModeFilter">
        <option value="distribution">קו חלוקה + סדר הפצה</option>
        <option value="loading">לפי סדר העמסה</option>
      </select>
      <label>חיפוש:</label>
      <input type="text" id="labelsSearchInput" placeholder="חפש לפי שם מוסד או מס׳ לקוח..." style="padding:5px;font-size:14px;width:250px;border:1px solid #ccc;border-radius:4px;">
    </div>
    <div class="labels-actions">
      <button class="btn download" onclick="downloadLabelsCSV()" id="downloadLabelsBtn">📥 הורד CSV</button>
      <button class="btn download" onclick="downloadLabelsPDF()" id="downloadLabelsPDFBtn">📄 הורד PDF</button>
    </div>
    <div class="table-container" id="labelsContainer"></div>
  </div>

  <div id="tabAllergenLabels" class="tab-content">
    <div class="report-controls">
      <label>קו חלוקה:</label>
      <select id="allergenLabelsDistrLineFilter">
        <option value="">הכל</option>
      </select>
      <label>סדר מיון:</label>
      <select id="allergenLabelsSortFilter">
        <option value="distribution">קו חלוקה + סדר הפצה</option>
        <option value="customer">לפי שם לקוח</option>
      </select>
    </div>
    <div class="labels-actions">
      <button class="btn download" onclick="printAllergenLabels()" id="printAllergenLabelsBtn">🖨️ הדפס מדבקות</button>
      <button class="btn download" onclick="downloadAllergenLabelsPDF()" id="downloadAllergenLabelsPDFBtn">📄 הורד PDF</button>
    </div>
    <div class="table-container" id="allergenLabelsContainer"></div>
  </div>
</div>

<!-- Modal for showing order details -->
<div id="itemModal" class="modal-overlay">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="modalTitle">פרטי הזמנות</h2>
      <button class="modal-close" onclick="closeItemModal()">✕ סגור</button>
    </div>
    <div class="modal-body" id="modalBody">
      <!-- Content will be inserted here -->
    </div>
  </div>
</div>


<!-- jQuery and DataTables - נטען קודם כי הקוד שלנו תלוי בהם -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<!-- קבצי JavaScript של האפליקציה -->
<script src="js/config.js"></script>
<script src="js/app.js"></script>

</body>
</html>
